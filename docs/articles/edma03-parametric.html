<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parametric estimation • EDMAinR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Parametric estimation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-55877016-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-55877016-2');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EDMAinR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/edma01-data.html">EDMA data</a>
    </li>
    <li>
      <a href="../articles/edma02-form.html">EDMA form matrix</a>
    </li>
    <li>
      <a href="../articles/edma03-parametric.html">Parametric estimation</a>
    </li>
    <li>
      <a href="../articles/edma04-form-difference.html">EDMA form difference matrix</a>
    </li>
    <li>
      <a href="../articles/edma05-growth.html">EDMA growth matrix</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Parametric estimation</h1>
                        <h4 class="author">Peter Solymos</h4>
            
      
      
      <div class="hidden name"><code>edma03-parametric.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This tutorial describes how to estimate SigmaK and assess if it is estimable. Parametric estimation of SigmaK involves the following steps:</p>
<ol style="list-style-type: decimal">
<li>non-parametric estimation of mean form and SigmaKstar using the <code>edma_fit</code> function,</li>
<li>constructing of a pattern matrix based on biology of landmarks and respecting statistical constraints,</li>
<li>use the <code>SigmaK_fit</code> to estimate SigmaK using the non-parametric fit and the pattern matrix.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(EDMAinR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; EDMAinR 0.1-4     2020-08-17</span></a></code></pre></div>
</div>
<div id="simulated-landmark-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-landmark-data" class="anchor"></a>Simulated landmark data</h2>
<p>To demonstrate the workflow, let us simulate some data. Simulation is useful for checking the limits of the estimating procedure. We know what the ‘true’ input are, because we are controlling those through the simulation. We can then compare the outputs (our estimates), to the known inputs, and this is how we evaluate the utility and limitations of our methods.</p>
<p>Let us begin with the following set of 6 landmarks in 2-dimensions:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">(M &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">82</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">-50</span>, <span class="dv">-37</span>, <span class="dv">-37</span>, </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dv">0</span>,  <span class="dv">17</span>, <span class="dv">-17</span>, <span class="dv">0</span>,  <span class="dv">41</span>,  <span class="dv">-41</span>), </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">dim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">6</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">dimnames=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"L"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"X"</span>, <span class="st">"Y"</span>))))</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;      X   Y</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; L1  82   0</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; L2  21  17</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; L3  22 -17</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; L4 -50   0</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; L5 -37  41</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; L6 -37 -41</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(M, <span class="dt">pch=</span><span class="dv">3</span>, <span class="dt">asp=</span><span class="dv">1</span>, <span class="dt">axes=</span><span class="ot">FALSE</span>, <span class="dt">ann=</span><span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">"n"</span>)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(M, <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The simplest SigmaK variance-covariance matrix is <span class="math inline">\(\sigma^2 I\)</span>, that is constant variance (<span class="math inline">\(\sigma^2\)</span>) in the diagonal of the <span class="math inline">\(6\times6\)</span> square matrix and 0’s in all the off-diagonal cells:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">sigma &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">SigmaK &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(sigma<span class="op">^</span><span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; L1  4  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; L2  .  4  .  .  .  .</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; L3  .  .  4  .  .  .</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  4  .  .</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  .  4  .</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  .  .  4</span></a></code></pre></div>
<p>We can use the <code>edma_simulate_data</code> function to simulate <code>n</code> specimen given form matrix <code>M</code> and covariance matrix <code>SigmaK</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can see from the figure that the constant variance translates to roughly circle shaped convex hulls around the landmarks (the hull bounds the landmarks form the <code>n</code> specimens), and the size of these patches is similar (equal variances).</p>
</div>
<div id="nonparametric-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#nonparametric-estimation" class="anchor"></a>Nonparametric estimation</h2>
<p>We use the non-parametric EDMA algorithm to estimate the form matrix and the SigmaKstar matrix:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a></code></pre></div>
<p>Because we used simulations, we can compare the known <code>M</code> matrix with the estimated mean form:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">M                       <span class="co"># true</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt;      X   Y</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; L1  82   0</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; L2  21  17</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; L3  22 -17</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; L4 -50   0</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; L5 -37  41</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; L6 -37 -41</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/edma_fit.html">Meanform</a></span>(fit), <span class="dv">2</span>) <span class="co"># estimate</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;         X      Y</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; L1 -81.87   0.12</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; L2 -20.80  17.10</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; L3 -21.89 -16.96</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; L4  50.30  -0.17</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; L5  37.20  40.95</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; L6  37.06 -41.03</span></a></code></pre></div>
<p>The ‘true’ <code>SigmaKstar</code> matrix is stored in our simulation object:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(sim, <span class="st">"simulation_settings"</span>)<span class="op">$</span>SigmaKstar, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;       L1    L2    L3    L4    L5    L6</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; L1  3.33 -0.67 -0.67 -0.67 -0.67 -0.67</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; L2 -0.67  3.33 -0.67 -0.67 -0.67 -0.67</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; L3 -0.67 -0.67  3.33 -0.67 -0.67 -0.67</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; L4 -0.67 -0.67 -0.67  3.33 -0.67 -0.67</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; L5 -0.67 -0.67 -0.67 -0.67  3.33 -0.67</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; L6 -0.67 -0.67 -0.67 -0.67 -0.67  3.33</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/edma_fit.html">SigmaKstar</a></span>(fit), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;       L1    L2    L3    L4    L5    L6</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; L1  3.43 -0.68 -0.58 -0.82 -0.90 -0.46</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; L2 -0.68  3.43 -0.70 -0.71 -0.64 -0.71</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; L3 -0.58 -0.70  3.51 -0.84 -0.72 -0.66</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; L4 -0.82 -0.71 -0.84  3.55 -0.42 -0.77</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; L5 -0.90 -0.64 -0.72 -0.42  3.22 -0.54</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; L6 -0.46 -0.71 -0.66 -0.77 -0.54  3.14</span></a></code></pre></div>
</div>
<div id="pattern-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#pattern-matrix" class="anchor"></a>Pattern matrix</h2>
<p>The parametric estimation requires a pattern matrix that describes the unknowns in the <code>SigmaK</code> matrix. This <code>SigmaK</code> matrix is the variance covariance matrix describing the variances (diagonal) associated with each landmark, and the covariances (off-diagonal) among the landmarks.</p>
<p>The pattern matrix can be constructed in R, but when the number of landmarks is high and variances are expected to differ among the landmarks, it might be easier to construct the pattern matrix in a spreadsheet editor (Excel). Here is how the file should be constructed (the package contains example files, see <code><a href="../reference/SigmaK_fit.html">?read_pattern</a></code>):</p>
<ul>
<li>the 1st row describes the landmarks starting from the 2nd column,</li>
<li>the 1st column describes the landmarks in the same order as the column headers,</li>
<li>leave the cell in the top left corner empty,</li>
<li>use unique names or numbers in the rest of the table to denote unique variables in the Sigma matrix,</li>
<li>structural zeros (cells where the covariance is known or assumed to be 0) have to be blank,</li>
<li>there cannot be blank cells in the diagonal of the matrix,</li>
<li>values below and above the diagonal must be symmetric (value in row 2/column 3 must be the same as row 3/column 2), either unique names or numbers, or blank.</li>
</ul>
<p>The pattern matrix for the equal variance case looks like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"1"</span>),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(p)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; L1 1  .  .  .  .  . </span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; L2 .  1  .  .  .  . </span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; L3 .  .  1  .  .  . </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; L4 .  .  .  1  .  . </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; L5 .  .  .  .  1  . </span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; L6 .  .  .  .  .  1</span></a></code></pre></div>
</div>
<div id="parametric-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#parametric-estimation" class="anchor"></a>Parametric estimation</h2>
<p>The parametric estimation requires the fitted object from the previous step of nonparametric estimation (that gave us the estimate of the mean form and SigmaKstar), and the pattern matrix, so that the program knows what parameters to estimate and where those are placed in the SigmaK matrix:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">(o &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; EDMA parametric fit (2-step): Simulated landmark data</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; Call: SigmaK_fit(object = fit, pattern = p)</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; 2 dimensions, 6 landmarks, 1000 replicates, no bootstrap</span></a></code></pre></div>
<p>Now let us compare the ‘true’ SigmaK matrix with the estimated ones. The ‘full’ estimate of SigmaK can be accessed by the <code>SigmaKfull</code> function which follows Hu (2007).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)                  <span class="co"># true</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; L1  4  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; L2  .  4  .  .  .  .</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; L3  .  .  4  .  .  .</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; L4  .  .  .  4  .  .</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; L5  .  .  .  .  4  .</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; L6  .  .  .  .  .  4</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/SigmaK_fit.html">SigmaKfull</a></span>(o), <span class="dv">2</span>)) <span class="co"># full estimate</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;      L1   L2   L3   L4   L5   L6</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; L1 4.14    .    .    .    .    .</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; L2    . 4.08    .    .    .    .</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; L3    .    . 3.97    .    .    .</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; L4    .    .    . 4.48    .    .</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; L5    .    .    .    . 4.32    .</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; L6    .    .    .    .    . 3.35</span></a></code></pre></div>
<p>We can see in the SigmaKfull matrix that the values are slightly different, because the algorithm treats every non-<code>NA</code> entry in the pattern matrix (non-0 cell in the SigmaK matrix to be estimated) as an unknown variable.</p>
<p>The <code>SigmaK</code> by default returns the estimates that are constrained by the pattern matrix. We call this default method the 2-step algorithm because the numerical optimization follows the estimation of SigmaKfull. We then use the pattern matrix to constrain the parameters denoted by the same labels to be the same value. Let’s see what value we get for our constant variance parameter:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)              <span class="co"># true</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; L1  4  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; L2  .  4  .  .  .  .</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; L3  .  .  4  .  .  .</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; L4  .  .  .  4  .  .</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; L5  .  .  .  .  4  .</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; L6  .  .  .  .  .  4</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK</a></span>(o), <span class="dv">2</span>)) <span class="co"># constrained estimate</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;      A    B    C    D    E    F</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; A 4.06    .    .    .    .    .</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; B    . 4.06    .    .    .    .</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; C    .    . 4.06    .    .    .</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; D    .    .    . 4.06    .    .</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; E    .    .    .    . 4.06    .</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; F    .    .    .    .    . 4.06</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">true=</span>sigma<span class="op">^</span><span class="dv">2</span>, <span class="dt">estimate=</span>o<span class="op">$</span>results<span class="op">$</span>par)</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;   true estimate</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; 1    4 4.056236</span></a></code></pre></div>
<p>There is an other method we call the 1-step algorithm where the numerical optimization is performed without the information from SigmaKfull. It uses only the SigmaKstar matrix. We can use this algorithm as:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">(o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt; EDMA parametric fit (1-step): Simulated landmark data</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; Call: SigmaK_fit(object = fit, pattern = p, twostep = FALSE)</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; 2 dimensions, 6 landmarks, 1000 replicates, no bootstrap</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">true=</span>sigma<span class="op">^</span><span class="dv">2</span>, <span class="dt">onestep=</span>o1<span class="op">$</span>results<span class="op">$</span>par, <span class="dt">twostep=</span>o<span class="op">$</span>results<span class="op">$</span>par)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;   true  onestep  twostep</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; 1    4 4.056236 4.056236</span></a></code></pre></div>
<p>Both estimates look the same and very close to the true estimate.</p>
</div>
<div id="unequal-variance-case" class="section level2">
<h2 class="hasAnchor">
<a href="#unequal-variance-case" class="anchor"></a>Unequal variance case</h2>
<p>In the unequal variance case we can have different variances for the different landmarks. Here is the corresponding pattern matrix:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">plot_tb</a></span>(p)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>The SigmaK matrix looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">12</span>, <span class="st">"2"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">SigmaK &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">make_Sigma</a></span>(parm, p)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; L1 12  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; L2  . 12  .  .  .  .</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt; L3  .  . 12  .  .  .</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  2  .  .</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  .  2  .</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  .  .  2</span></a></code></pre></div>
<p>The unequal variances translate to the following simulated data:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>We can see the different sizes of the convex hulls corresponding to the variances for each landmark.</p>
<p>For the estimation, we use <code>edma_fit</code> and <code>SigmaK_fit</code> as before:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)                   <span class="co"># true</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; L1 12  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; L2  . 12  .  .  .  .</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; L3  .  . 12  .  .  .</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  2  .  .</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  .  2  .</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  .  .  2</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/SigmaK_fit.html">SigmaKfull</a></span>(o2), <span class="dv">2</span>)) <span class="co"># full estimate</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt;       L1    L2    L3    L4    L5    L6</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; L1 11.89     .     .     .     .     .</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; L2     . 10.28     .     .     .     .</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; L3     .     . 12.99     .     .     .</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; L4     .     .     .  2.30     .     .</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; L5     .     .     .     .  1.92     .</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt; L6     .     .     .     .     .  2.59</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">true=</span>parm, </a>
<a class="sourceLine" id="cb16-21" data-line-number="21">  <span class="dt">onestep=</span>o1<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)], </a>
<a class="sourceLine" id="cb16-22" data-line-number="22">  <span class="dt">twostep=</span>o2<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)])</a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt;   true   onestep   twostep</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt; 1   12 11.825347 11.721269</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt; 2    2  2.165456  2.269536</span></a></code></pre></div>
<p>Let’s have 6 different values in the diagonal:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    <span class="ot">NA</span>, <span class="st">"2"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"3"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"4"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"5"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"6"</span>),</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">plot_tb</a></span>(p)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>The SigmaK matrix looks like this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">12</span>, <span class="st">"2"</span>=<span class="dv">8</span>, <span class="st">"3"</span>=<span class="dv">11</span>, <span class="st">"4"</span>=<span class="dv">3</span>, <span class="st">"5"</span>=<span class="dv">10</span>, <span class="st">"6"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">SigmaK &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">make_Sigma</a></span>(parm, p)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt; L1 12  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; L2  .  8  .  .  .  .</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; L3  .  . 11  .  .  .</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  3  .  .</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  . 10  .</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  .  .  2</span></a></code></pre></div>
<p>This translates to the following simulated data:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>We can now see that the constrained and full solutions are identical, because no parameters are repeated in our pattern matrix:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)                   <span class="co"># true</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt; L1 12  .  .  .  .  .</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt; L2  .  8  .  .  .  .</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt; L3  .  . 11  .  .  .</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  3  .  .</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  . 10  .</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  .  .  2</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/SigmaK_fit.html">SigmaKfull</a></span>(o2), <span class="dv">2</span>)) <span class="co"># full estimate</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt;       L1    L2    L3    L4    L5    L6</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt; L1 11.50     .     .     .     .     .</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; L2     .  8.43     .     .     .     .</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; L3     .     . 12.25     .     .     .</span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt; L4     .     .     .  2.16     .     .</span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt; L5     .     .     .     .  8.69     .</span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co">#&gt; L6     .     .     .     .     .  2.52</span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">true=</span>parm, </a>
<a class="sourceLine" id="cb20-21" data-line-number="21">  <span class="dt">onestep=</span>o1<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)], </a>
<a class="sourceLine" id="cb20-22" data-line-number="22">  <span class="dt">twostep=</span>o2<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)])</a>
<a class="sourceLine" id="cb20-23" data-line-number="23"><span class="co">#&gt;   true   onestep   twostep</span></a>
<a class="sourceLine" id="cb20-24" data-line-number="24"><span class="co">#&gt; 1   12 11.498857 11.498709</span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="co">#&gt; 2    8  8.245809  8.425900</span></a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="co">#&gt; 3   11 11.042865 12.248140</span></a>
<a class="sourceLine" id="cb20-27" data-line-number="27"><span class="co">#&gt; 4    3  2.760571  2.164662</span></a>
<a class="sourceLine" id="cb20-28" data-line-number="28"><span class="co">#&gt; 5   10  9.881921  8.687253</span></a>
<a class="sourceLine" id="cb20-29" data-line-number="29"><span class="co">#&gt; 6    2  2.112453  2.518331</span></a></code></pre></div>
<p>We can see that both the 1-step and 2-step algorithms give estimates that are close to the true values when all the correlations (off-diagonal elements) of SigmaK are 0 (coded as <code>NA</code> in the pattern matrix).</p>
</div>
<div id="correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#correlations" class="anchor"></a>Correlations</h2>
<p>We can add correlations between the frontal (L1) and lateral (L2, L3) landmarks, and similarly to the other 3 landmarks:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">    <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>, <span class="st">"3"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>, <span class="ot">NA</span>,  <span class="st">"3"</span>),</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">plot_tb</a></span>(p)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>The SigmaK matrix looks like this:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">12</span>, <span class="st">"2"</span>=<span class="dv">1</span>, <span class="st">"3"</span>=<span class="dv">8</span>, <span class="st">"4"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">SigmaK &lt;-<span class="st"> </span>EDMAinR<span class="op">:::</span><span class="kw">.vec2mat</span>(parm, EDMAinR<span class="op">:::</span><span class="kw">.mat2fac</span>(p))</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; L1 12  1  1  .  .  .</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">#&gt; L2  1 12  .  .  .  .</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt; L3  1  . 12  .  .  .</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  8  2  2</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  2  8  .</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  2  .  8</span></a></code></pre></div>
<p>The unequal variances translate to the following simulated data:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"></a>
<a class="sourceLine" id="cb23-3" data-line-number="3">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>This setup seems estimable:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)                   <span class="co"># true</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt; L1 12  1  1  .  .  .</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="co">#&gt; L2  1 12  .  .  .  .</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; L3  1  . 12  .  .  .</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; L4  .  .  .  8  2  2</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt; L5  .  .  .  2  8  .</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="co">#&gt; L6  .  .  .  2  .  8</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/SigmaK_fit.html">SigmaKfull</a></span>(o2), <span class="dv">2</span>)) <span class="co"># full estimate</span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt;       L1    L2    L3    L4    L5    L6</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt; L1 11.57  0.98  1.58     .     .     .</span></a>
<a class="sourceLine" id="cb24-15" data-line-number="15"><span class="co">#&gt; L2  0.98 12.15     .     .     .     .</span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16"><span class="co">#&gt; L3  1.58     . 12.31     .     .     .</span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="co">#&gt; L4     .     .     .  7.46  2.00  1.36</span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18"><span class="co">#&gt; L5     .     .     .  2.00  8.32     .</span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19"><span class="co">#&gt; L6     .     .     .  1.36     .  8.63</span></a>
<a class="sourceLine" id="cb24-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">true=</span>parm, </a>
<a class="sourceLine" id="cb24-21" data-line-number="21">  <span class="dt">onestep=</span>o1<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)], </a>
<a class="sourceLine" id="cb24-22" data-line-number="22">  <span class="dt">twostep=</span>o2<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)])</a>
<a class="sourceLine" id="cb24-23" data-line-number="23"><span class="co">#&gt;   true   onestep   twostep</span></a>
<a class="sourceLine" id="cb24-24" data-line-number="24"><span class="co">#&gt; 1   12 11.988982 12.012470</span></a>
<a class="sourceLine" id="cb24-25" data-line-number="25"><span class="co">#&gt; 2    1  1.291689  1.277877</span></a>
<a class="sourceLine" id="cb24-26" data-line-number="26"><span class="co">#&gt; 3    8  8.200966  8.133914</span></a>
<a class="sourceLine" id="cb24-27" data-line-number="27"><span class="co">#&gt; 4    2  1.829278  1.679760</span></a></code></pre></div>
</div>
<div id="sensitivity-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#sensitivity-analysis" class="anchor"></a>Sensitivity analysis</h2>
<p>The parametric estimate is based on an optimization algorithm. This algorithm requires starting values for the unknown parameters. The robustness of our estimates can be tested using different starting values for the optimization. The idea is that we can call the estimates stable if the optimization finds the same values irrespective of the starting values.</p>
<p>We can assess the results in this regard using the <code>sensitivity</code> function. This function repeats the estimation <code>m</code> times by using a starting value that is the original starting value times a random uniform number. The same idea can be applied to the 1-step and 1-step estimator:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="../reference/SigmaK_fit.html">sensitivity</a></span>(o1)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co">#&gt;          par_1    par_2    par_3    par_4    value</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co">#&gt;  [1,] 11.98898 1.291689 8.200966 1.829278 1.770413</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co">#&gt;  [2,] 11.98897 1.294422 8.198867 1.833990 1.770523</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">#&gt;  [3,] 11.98557 1.282750 8.206205 1.832114 1.770555</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt;  [4,] 12.00125 1.300504 8.195235 1.834312 1.770929</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt;  [5,] 11.98718 1.290446 8.202447 1.830951 1.770420</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co">#&gt;  [6,] 11.98915 1.286699 8.205750 1.831073 1.770494</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">#&gt;  [7,] 11.99169 1.286468 8.216681 1.836992 1.770929</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">#&gt;  [8,] 11.99146 1.287296 8.198470 1.827432 1.770516</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="co">#&gt;  [9,] 11.98764 1.295328 8.189940 1.815521 1.770840</span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">#&gt; [10,] 11.98432 1.287713 8.204633 1.827749 1.770503</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co">#&gt; [11,] 12.01228 1.282848 8.219605 1.831498 1.773071</span></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="kw"><a href="../reference/SigmaK_fit.html">sensitivity</a></span>(o2)</a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">#&gt;          par_1    par_2    par_3    par_4        value</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#&gt;  [1,] 12.01247 1.277877 8.133914 1.679760 0.000000e+00</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="co">#&gt;  [2,] 12.01158 1.278736 8.135852 1.678110 8.012206e-06</span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="co">#&gt;  [3,] 12.01664 1.270053 8.130103 1.681810 9.733175e-05</span></a>
<a class="sourceLine" id="cb25-19" data-line-number="19"><span class="co">#&gt;  [4,] 12.01298 1.278160 8.134899 1.680438 1.774786e-06</span></a>
<a class="sourceLine" id="cb25-20" data-line-number="20"><span class="co">#&gt;  [5,] 12.01304 1.275850 8.131526 1.678458 1.183108e-05</span></a>
<a class="sourceLine" id="cb25-21" data-line-number="21"><span class="co">#&gt;  [6,] 12.01185 1.277407 8.133567 1.680789 1.785666e-06</span></a>
<a class="sourceLine" id="cb25-22" data-line-number="22"><span class="co">#&gt;  [7,] 12.02086 1.273592 8.134955 1.679580 8.980361e-05</span></a>
<a class="sourceLine" id="cb25-23" data-line-number="23"><span class="co">#&gt;  [8,] 12.02192 1.285185 8.121670 1.678262 2.948211e-04</span></a>
<a class="sourceLine" id="cb25-24" data-line-number="24"><span class="co">#&gt;  [9,] 12.00946 1.277510 8.137112 1.676533 2.980716e-05</span></a>
<a class="sourceLine" id="cb25-25" data-line-number="25"><span class="co">#&gt; [10,] 12.01085 1.278701 8.134720 1.679006 4.504664e-06</span></a>
<a class="sourceLine" id="cb25-26" data-line-number="26"><span class="co">#&gt; [11,] 12.01364 1.277477 8.132173 1.674293 3.443842e-05</span></a></code></pre></div>
<p>The <code>par_1</code>, <code>par_2</code>, etc. columns shows the parameter estimates for the unknown variables, the <code>value</code> column shows the value of the loss function evaluated these parameter values. Each row represent a separate run, the 1st row the original estimate, the rest from repeated runs with different starting values. We see that in this case the 2-step estimator is less sensitive to starting values, but both methods provide very similar estimates and loss function values.</p>
</div>
<div id="non-estimable-case-equi-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#non-estimable-case-equi-correlation" class="anchor"></a>Non-estimable case: equi-correlation</h2>
<p>The following parametrization is a very common parametrization. As we will see, contrary to the intuition that models with few unknowns (a single variance and a single covariance term) are identifiable, this model is actually non-identifiable. Let us walk through the steps of estimating the parameters and look for signs of non-identifiability:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">    <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">    <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">    <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">    <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>,</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">    <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>),</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">plot_tb</a></span>(p)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>The diagonal elements are <span class="math inline">\(\sigma^2\)</span> (equal variance), the off diagonal elements are <span class="math inline">\(\sigma^2\rho\)</span> where <span class="math inline">\(\rho\)</span> is the correlation:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">10</span>, <span class="st">"2"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">SigmaK &lt;-<span class="st"> </span>EDMAinR<span class="op">:::</span><span class="kw">.vec2mat</span>(parm, EDMAinR<span class="op">:::</span><span class="kw">.mat2fac</span>(p))</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt; L1 10  2  2  2  2  2</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt; L2  2 10  2  2  2  2</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt; L3  2  2 10  2  2  2</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt; L4  2  2  2 10  2  2</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt; L5  2  2  2  2 10  2</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt; L6  2  2  2  2  2 10</span></a></code></pre></div>
<p>The correlation lead to more ellipsoid shapes for the simulated landmarks:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="co">#&gt; Error in .SigmaK_fit(object$SigmaKstar, pattern, twostep = twostep, check = check,  : </span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="co">#&gt;   too many unknowns (21 &gt; 15) in pattern matrix</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="co">#&gt; Error in .SigmaK_fit(object$SigmaKstar, pattern, twostep = twostep, check = check,  : </span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="co">#&gt;   too many unknowns (21 &gt; 15) in pattern matrix</span></a></code></pre></div>
<p>Oops, we get an error in both cases. Based on Hu (2007), we need to have a certain number of 0s in the SigmaK matrix to be able to identify the parameters. The number of non-zero values cannot be larger than <span class="math inline">\(K (K-1)/2\)</span> (counting the elements in the diagonal and the lower triangle only). This is what the error informs us about. The <code>check</code> argument can be used to disable this check and see what we get if we disregard such mathematical results:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>, <span class="dt">check=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>, <span class="dt">check=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="co">#&gt; Error in .SigmaK_fit(object$SigmaKstar, pattern, twostep = twostep, check = check,  : </span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co">#&gt;   Error in .SigmaK_fit_full(SigmaKstar, pattern) : </span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="co">#&gt;   pattern matrix leads to non-invertible A matrix</span></a></code></pre></div>
<p>Interesting. The 1-step estimator works because it does not depend on SigmaKfull. The 2-step estimator, however, fails because the so called <span class="math inline">\(A\)</span> matrix that we need to estimate SigmaKfull is non-invertible.</p>
<p>Let’s investigate the sensitivity analysis results for the 1-step estimator:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="../reference/SigmaK_fit.html">sensitivity</a></span>(o1)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co">#&gt;           par_1      par_2    value</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co">#&gt;  [1,]  4.748531 -3.4691179 1.648628</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="co">#&gt;  [2,]  6.890880 -1.3262843 1.648628</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="co">#&gt;  [3,]  6.151392 -2.0663959 1.648629</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="co">#&gt;  [4,]  6.452819 -1.7642788 1.648628</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="co">#&gt;  [5,]  8.568215  0.3510408 1.648628</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="co">#&gt;  [6,]  8.751653  0.5345982 1.648628</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9"><span class="co">#&gt;  [7,] 10.031098  1.8137888 1.648628</span></a>
<a class="sourceLine" id="cb31-10" data-line-number="10"><span class="co">#&gt;  [8,] 10.092239  1.8747895 1.648628</span></a>
<a class="sourceLine" id="cb31-11" data-line-number="11"><span class="co">#&gt;  [9,]  9.797219  1.5798604 1.648628</span></a>
<a class="sourceLine" id="cb31-12" data-line-number="12"><span class="co">#&gt; [10,] 13.610085  5.3924150 1.648628</span></a>
<a class="sourceLine" id="cb31-13" data-line-number="13"><span class="co">#&gt; [11,]  7.928411 -0.2889969 1.648628</span></a></code></pre></div>
<p>The clear sign of non-identifiability here is that the loss function values are identical across runs, but the estimates vary widely. Just as a reminder, our true values were 10 for variance and 2 for covariance.</p>
</div>
<div id="non-estimable-case-blocks" class="section level2">
<h2 class="hasAnchor">
<a href="#non-estimable-case-blocks" class="anchor"></a>Non-estimable case: blocks</h2>
<p>We can add correlations between the frontal (L1) and lateral (L2, L3) landmarks, and similarly to the other 3 landmarks:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">    <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">    <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>, <span class="st">"4"</span>,<span class="st">"3"</span>),</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">plot_tb</a></span>(p)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">12</span>, <span class="st">"2"</span>=<span class="dv">1</span>, <span class="st">"3"</span>=<span class="dv">8</span>, <span class="st">"4"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">SigmaK &lt;-<span class="st"> </span>EDMAinR<span class="op">:::</span><span class="kw">.vec2mat</span>(parm, EDMAinR<span class="op">:::</span><span class="kw">.mat2fac</span>(p))</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p)</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="co">#&gt; L1 12  1  1  .  .  .</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#&gt; L2  1 12  1  .  .  .</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co">#&gt; L3  1  1 12  .  .  .</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co">#&gt; L4  .  .  .  8  2  2</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="co">#&gt; L5  .  .  .  2  8  2</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="co">#&gt; L6  .  .  .  2  2  8</span></a></code></pre></div>
<p>The number of non-zero entries (diagonal and lower triangle) in this case is 12 which is less than <span class="math inline">\(K(K-1)/2=15\)</span>. According to the simple rule of thumb from above, this should work.</p>
<p>The bloc design translates to the following simulated data:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"></a>
<a class="sourceLine" id="cb34-3" data-line-number="3">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>Although 12 &lt; 15, this setup still leads to non-ivertible <span class="math inline">\(A\)</span> matrix for the 2-step algorithm, and we can see the clear signs of non-estimability for the 1-step algorithm based on the sensitivity analysis:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>, <span class="dt">check=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>, <span class="dt">check=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="co">#&gt; Error in .SigmaK_fit(object$SigmaKstar, pattern, twostep = twostep, check = check,  : </span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="co">#&gt;   Error in .SigmaK_fit_full(SigmaKstar, pattern) : </span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="co">#&gt;   pattern matrix leads to non-invertible A matrix</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="kw"><a href="../reference/SigmaK_fit.html">sensitivity</a></span>(o1)</a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="co">#&gt;           par_1       par_2     par_3      par_4    value</span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"><span class="co">#&gt;  [1,] 15.164106  4.40603918  4.368686 -1.3228632 2.134815</span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10"><span class="co">#&gt;  [2,]  7.742781 -3.01601959 11.791203  6.0997825 2.134820</span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="co">#&gt;  [3,] 13.030156  2.27228960  6.501521  0.8108885 2.134815</span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="co">#&gt;  [4,] 12.703420  1.94567126  6.828631  1.1369303 2.134815</span></a>
<a class="sourceLine" id="cb35-13" data-line-number="13"><span class="co">#&gt;  [5,] 12.277616  1.51973461  7.255024  1.5639104 2.134815</span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14"><span class="co">#&gt;  [6,]  8.085943 -2.67088711 11.446278  5.7547026 2.134815</span></a>
<a class="sourceLine" id="cb35-15" data-line-number="15"><span class="co">#&gt;  [7,] 13.967915  3.21107553  5.563649 -0.1275584 2.134815</span></a>
<a class="sourceLine" id="cb35-16" data-line-number="16"><span class="co">#&gt;  [8,]  4.842881 -5.91486050 14.689484  8.9972697 2.134816</span></a>
<a class="sourceLine" id="cb35-17" data-line-number="17"><span class="co">#&gt;  [9,] 10.753748 -0.00333326  8.777853  3.0868331 2.134814</span></a>
<a class="sourceLine" id="cb35-18" data-line-number="18"><span class="co">#&gt; [10,]  9.177126 -1.58054022 10.355324  4.6639958 2.134814</span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19"><span class="co">#&gt; [11,]  3.424321 -7.33235585 16.106952 10.4154903 2.134815</span></a></code></pre></div>
</div>
<div id="an-estimable-block-pattern" class="section level2">
<h2 class="hasAnchor">
<a href="#an-estimable-block-pattern" class="anchor"></a>An estimable block pattern</h2>
<p>Let’s try a slight variation of this block design:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">    <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,   <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">    <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="st">"1"</span>, <span class="ot">NA</span>,   <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">    <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"3"</span>,  <span class="st">"4"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>,  <span class="st">"3"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>,  <span class="st">"4"</span>,<span class="st">"3"</span>),</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="kw"><a href="../reference/SigmaK_fit.html">plot_tb</a></span>(p)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">12</span>, <span class="st">"2"</span>=<span class="dv">1</span>, <span class="st">"3"</span>=<span class="dv">8</span>, <span class="st">"4"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">SigmaK &lt;-<span class="st"> </span>EDMAinR<span class="op">:::</span><span class="kw">.vec2mat</span>(parm, EDMAinR<span class="op">:::</span><span class="kw">.mat2fac</span>(p))</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p)</a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)</a>
<a class="sourceLine" id="cb37-6" data-line-number="6"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7"><span class="co">#&gt; L1 12  1  1  1  .  .</span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8"><span class="co">#&gt; L2  1 12  .  .  .  .</span></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="co">#&gt; L3  1  . 12  .  .  .</span></a>
<a class="sourceLine" id="cb37-10" data-line-number="10"><span class="co">#&gt; L4  1  .  .  8  2  2</span></a>
<a class="sourceLine" id="cb37-11" data-line-number="11"><span class="co">#&gt; L5  .  .  .  2  8  2</span></a>
<a class="sourceLine" id="cb37-12" data-line-number="12"><span class="co">#&gt; L6  .  .  .  2  2  8</span></a></code></pre></div>
<p>We have again 12 non-zero entries, but the 0 from the 1st row and 2nd colum to the 3rd row and 1st column (and its pair in the upper triangle).</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2"></a>
<a class="sourceLine" id="cb38-3" data-line-number="3">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">plot_2d</a></span>(sim, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">80</span>, <span class="dv">100</span>), <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(tmp, <span class="st">"coordinates"</span>)</a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(xy[,<span class="dv">1</span>]<span class="op">+</span><span class="dv">15</span>, xy[,<span class="dv">2</span>], <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(xy), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">col=</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="edma03-parametric_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>Everything looks fine now:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p, <span class="dt">twostep=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4"></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(SigmaK)                   <span class="co"># true</span></a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="co">#&gt;    L1 L2 L3 L4 L5 L6</span></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="co">#&gt; L1 12  1  1  1  .  .</span></a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="co">#&gt; L2  1 12  .  .  .  .</span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9"><span class="co">#&gt; L3  1  . 12  .  .  .</span></a>
<a class="sourceLine" id="cb39-10" data-line-number="10"><span class="co">#&gt; L4  1  .  .  8  2  2</span></a>
<a class="sourceLine" id="cb39-11" data-line-number="11"><span class="co">#&gt; L5  .  .  .  2  8  2</span></a>
<a class="sourceLine" id="cb39-12" data-line-number="12"><span class="co">#&gt; L6  .  .  .  2  2  8</span></a>
<a class="sourceLine" id="cb39-13" data-line-number="13"><span class="kw"><a href="../reference/SigmaK_fit.html">print_tb</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="../reference/SigmaK_fit.html">SigmaKfull</a></span>(o2), <span class="dv">2</span>)) <span class="co"># full estimate</span></a>
<a class="sourceLine" id="cb39-14" data-line-number="14"><span class="co">#&gt;       L1    L2    L3    L4    L5    L6</span></a>
<a class="sourceLine" id="cb39-15" data-line-number="15"><span class="co">#&gt; L1 12.88  2.80  1.90  0.27     .     .</span></a>
<a class="sourceLine" id="cb39-16" data-line-number="16"><span class="co">#&gt; L2  2.80 13.46     .     .     .     .</span></a>
<a class="sourceLine" id="cb39-17" data-line-number="17"><span class="co">#&gt; L3  1.90     . 13.15     .     .     .</span></a>
<a class="sourceLine" id="cb39-18" data-line-number="18"><span class="co">#&gt; L4  0.27     .     .  6.00  0.54  0.80</span></a>
<a class="sourceLine" id="cb39-19" data-line-number="19"><span class="co">#&gt; L5     .     .     .  0.54  6.26  1.14</span></a>
<a class="sourceLine" id="cb39-20" data-line-number="20"><span class="co">#&gt; L6     .     .     .  0.80  1.14  8.03</span></a>
<a class="sourceLine" id="cb39-21" data-line-number="21"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">true=</span>parm, </a>
<a class="sourceLine" id="cb39-22" data-line-number="22">  <span class="dt">onestep=</span>o1<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)], </a>
<a class="sourceLine" id="cb39-23" data-line-number="23">  <span class="dt">twostep=</span>o2<span class="op">$</span>results<span class="op">$</span>par[<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(parm)])</a>
<a class="sourceLine" id="cb39-24" data-line-number="24"><span class="co">#&gt;   true   onestep   twostep</span></a>
<a class="sourceLine" id="cb39-25" data-line-number="25"><span class="co">#&gt; 1   12 12.573567 13.162196</span></a>
<a class="sourceLine" id="cb39-26" data-line-number="26"><span class="co">#&gt; 2    1  1.468189  1.657838</span></a>
<a class="sourceLine" id="cb39-27" data-line-number="27"><span class="co">#&gt; 3    8  7.615555  6.761063</span></a>
<a class="sourceLine" id="cb39-28" data-line-number="28"><span class="co">#&gt; 4    2  1.682164  0.827751</span></a>
<a class="sourceLine" id="cb39-29" data-line-number="29"></a>
<a class="sourceLine" id="cb39-30" data-line-number="30"><span class="kw"><a href="../reference/SigmaK_fit.html">sensitivity</a></span>(o1)</a>
<a class="sourceLine" id="cb39-31" data-line-number="31"><span class="co">#&gt;          par_1    par_2    par_3    par_4    value</span></a>
<a class="sourceLine" id="cb39-32" data-line-number="32"><span class="co">#&gt;  [1,] 12.57357 1.468189 7.615555 1.682164 5.975322</span></a>
<a class="sourceLine" id="cb39-33" data-line-number="33"><span class="co">#&gt;  [2,] 12.58071 1.472606 7.605482 1.674960 5.975466</span></a>
<a class="sourceLine" id="cb39-34" data-line-number="34"><span class="co">#&gt;  [3,] 12.57003 1.472980 7.612560 1.678754 5.975490</span></a>
<a class="sourceLine" id="cb39-35" data-line-number="35"><span class="co">#&gt;  [4,] 12.56653 1.465929 7.621837 1.691717 5.975483</span></a>
<a class="sourceLine" id="cb39-36" data-line-number="36"><span class="co">#&gt;  [5,] 12.57396 1.470649 7.609983 1.676606 5.975394</span></a>
<a class="sourceLine" id="cb39-37" data-line-number="37"><span class="co">#&gt;  [6,] 12.57319 1.468542 7.612556 1.682648 5.975348</span></a>
<a class="sourceLine" id="cb39-38" data-line-number="38"><span class="co">#&gt;  [7,] 12.56442 1.466028 7.619740 1.687996 5.975462</span></a>
<a class="sourceLine" id="cb39-39" data-line-number="39"><span class="co">#&gt;  [8,] 12.58323 1.468371 7.606760 1.675192 5.975550</span></a>
<a class="sourceLine" id="cb39-40" data-line-number="40"><span class="co">#&gt;  [9,] 12.57912 1.469446 7.614010 1.679855 5.975370</span></a>
<a class="sourceLine" id="cb39-41" data-line-number="41"><span class="co">#&gt; [10,] 12.58000 1.468876 7.614391 1.681572 5.975398</span></a>
<a class="sourceLine" id="cb39-42" data-line-number="42"><span class="co">#&gt; [11,] 12.57062 1.466483 7.613593 1.683689 5.975360</span></a>
<a class="sourceLine" id="cb39-43" data-line-number="43"><span class="kw"><a href="../reference/SigmaK_fit.html">sensitivity</a></span>(o2)</a>
<a class="sourceLine" id="cb39-44" data-line-number="44"><span class="co">#&gt;          par_1    par_2    par_3     par_4        value</span></a>
<a class="sourceLine" id="cb39-45" data-line-number="45"><span class="co">#&gt;  [1,] 13.16220 1.657838 6.761063 0.8277510 0.000000e+00</span></a>
<a class="sourceLine" id="cb39-46" data-line-number="46"><span class="co">#&gt;  [2,] 13.16222 1.657624 6.764423 0.8243226 2.309325e-05</span></a>
<a class="sourceLine" id="cb39-47" data-line-number="47"><span class="co">#&gt;  [3,] 13.16115 1.655461 6.760147 0.8263303 9.602650e-06</span></a>
<a class="sourceLine" id="cb39-48" data-line-number="48"><span class="co">#&gt;  [4,] 13.16053 1.657458 6.761152 0.8267646 3.897586e-06</span></a>
<a class="sourceLine" id="cb39-49" data-line-number="49"><span class="co">#&gt;  [5,] 13.16457 1.659400 6.760337 0.8248463 1.702563e-05</span></a>
<a class="sourceLine" id="cb39-50" data-line-number="50"><span class="co">#&gt;  [6,] 13.15444 1.648954 6.755374 0.8249546 1.792628e-04</span></a>
<a class="sourceLine" id="cb39-51" data-line-number="51"><span class="co">#&gt;  [7,] 13.15916 1.656532 6.761350 0.8282018 1.120905e-05</span></a>
<a class="sourceLine" id="cb39-52" data-line-number="52"><span class="co">#&gt;  [8,] 13.14011 1.673423 6.761018 0.8316202 7.454372e-04</span></a>
<a class="sourceLine" id="cb39-53" data-line-number="53"><span class="co">#&gt;  [9,] 13.16342 1.657751 6.761367 0.8270895 2.034351e-06</span></a>
<a class="sourceLine" id="cb39-54" data-line-number="54"><span class="co">#&gt; [10,] 13.15530 1.655695 6.758825 0.8335177 9.037772e-05</span></a>
<a class="sourceLine" id="cb39-55" data-line-number="55"><span class="co">#&gt; [11,] 13.17617 1.672984 6.771555 0.8306727 5.433578e-04</span></a></code></pre></div>
<p>The default checks for the <code>SigmaK_fit</code> can catch the non-identifiable situation. Use the <code>check=FALSE</code> and <code>twostep=FALSE</code> options with care.</p>
</div>
<div id="selecting-the-best-parametric-model" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-the-best-parametric-model" class="anchor"></a>Selecting the best parametric model</h2>
<p>Assumptions about biological mechanisms driving the 0 pattern in the covariance matrix can help researchers to formulate hypotheses. If these hypotheses translate into patterns that are estimable, we can use the loss function value from the 1-step estimator to tell which model fits the data better:</p>
<p>We will use the <code>p1</code> pattern matrix to simulate the data, and we will use all 5 identifiable patterns to try to estimate the parametric SigmaK matrix.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">p1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">    <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-6" data-line-number="6">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-7" data-line-number="7">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"1"</span>),</a>
<a class="sourceLine" id="cb40-8" data-line-number="8">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb40-9" data-line-number="9">p2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb40-10" data-line-number="10">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">    <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-12" data-line-number="12">    <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-13" data-line-number="13">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-14" data-line-number="14">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-15" data-line-number="15">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb40-16" data-line-number="16">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb40-17" data-line-number="17">p3 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb40-18" data-line-number="18">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-19" data-line-number="19">    <span class="ot">NA</span>, <span class="st">"2"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-20" data-line-number="20">    <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"3"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-21" data-line-number="21">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"4"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-22" data-line-number="22">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">"5"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-23" data-line-number="23">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>, <span class="st">"6"</span>),</a>
<a class="sourceLine" id="cb40-24" data-line-number="24">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb40-25" data-line-number="25">p4 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb40-26" data-line-number="26">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-27" data-line-number="27">    <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-28" data-line-number="28">    <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-29" data-line-number="29">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb40-30" data-line-number="30">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>, <span class="st">"3"</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-31" data-line-number="31">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>, <span class="ot">NA</span>,  <span class="st">"3"</span>),</a>
<a class="sourceLine" id="cb40-32" data-line-number="32">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb40-33" data-line-number="33">p5 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</a>
<a class="sourceLine" id="cb40-34" data-line-number="34">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-35" data-line-number="35">    <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,   <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-36" data-line-number="36">    <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="st">"1"</span>, <span class="ot">NA</span>,   <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb40-37" data-line-number="37">    <span class="st">"2"</span>, <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"3"</span>,  <span class="st">"4"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb40-38" data-line-number="38">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>,  <span class="st">"3"</span>, <span class="st">"4"</span>,</a>
<a class="sourceLine" id="cb40-39" data-line-number="39">    <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,  <span class="st">"4"</span>,  <span class="st">"4"</span>,<span class="st">"3"</span>),</a>
<a class="sourceLine" id="cb40-40" data-line-number="40">  <span class="dt">nrow=</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb40-41" data-line-number="41"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p1) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb40-42" data-line-number="42"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p2) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb40-43" data-line-number="43"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p3) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb40-44" data-line-number="44"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p4) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb40-45" data-line-number="45"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p5) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M), <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(M))</a>
<a class="sourceLine" id="cb40-46" data-line-number="46"></a>
<a class="sourceLine" id="cb40-47" data-line-number="47">parm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>=<span class="dv">12</span>, <span class="st">"2"</span>=<span class="dv">1</span>, <span class="st">"3"</span>=<span class="dv">8</span>, <span class="st">"4"</span>=<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb40-48" data-line-number="48">SigmaK &lt;-<span class="st"> </span>EDMAinR<span class="op">:::</span><span class="kw">.vec2mat</span>(parm, EDMAinR<span class="op">:::</span><span class="kw">.mat2fac</span>(p4))</a>
<a class="sourceLine" id="cb40-49" data-line-number="49"><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(SigmaK) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(p4)</a>
<a class="sourceLine" id="cb40-50" data-line-number="50">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_data.html">edma_simulate_data</a></span>(<span class="dt">n=</span>n, M, SigmaK)</a></code></pre></div>
<p>We fit 5 models, then compare the loss function values. The model with the smallest loss function value is the best:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/edma_fit.html">edma_fit</a></span>(sim)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">o1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p1, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">o2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p2, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">o3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p3, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">o4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p4, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">o5 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SigmaK_fit.html">SigmaK_fit</a></span>(fit, p5, <span class="dt">twostep=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-7" data-line-number="7"></a>
<a class="sourceLine" id="cb41-8" data-line-number="8">value &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(o1, o2, o3, o4, o5), <span class="cf">function</span>(o) {</a>
<a class="sourceLine" id="cb41-9" data-line-number="9">  o<span class="op">$</span>results<span class="op">$</span>value</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">})</a>
<a class="sourceLine" id="cb41-11" data-line-number="11"></a>
<a class="sourceLine" id="cb41-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb41-13" data-line-number="13">  <span class="dt">model=</span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb41-14" data-line-number="14">  <span class="dt">value=</span>value,</a>
<a class="sourceLine" id="cb41-15" data-line-number="15">  <span class="dt">delta=</span>value <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(value))</a>
<a class="sourceLine" id="cb41-16" data-line-number="16"><span class="co">#&gt;   model     value    delta</span></a>
<a class="sourceLine" id="cb41-17" data-line-number="17"><span class="co">#&gt; 1     1 34.668595 31.41005</span></a>
<a class="sourceLine" id="cb41-18" data-line-number="18"><span class="co">#&gt; 2     2 15.300222 12.04168</span></a>
<a class="sourceLine" id="cb41-19" data-line-number="19"><span class="co">#&gt; 3     3 13.868300 10.60976</span></a>
<a class="sourceLine" id="cb41-20" data-line-number="20"><span class="co">#&gt; 4     4  3.258541  0.00000</span></a>
<a class="sourceLine" id="cb41-21" data-line-number="21"><span class="co">#&gt; 5     5 11.362061  8.10352</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#simulated-landmark-data">Simulated landmark data</a></li>
      <li><a href="#nonparametric-estimation">Nonparametric estimation</a></li>
      <li><a href="#pattern-matrix">Pattern matrix</a></li>
      <li><a href="#parametric-estimation">Parametric estimation</a></li>
      <li><a href="#unequal-variance-case">Unequal variance case</a></li>
      <li><a href="#correlations">Correlations</a></li>
      <li><a href="#sensitivity-analysis">Sensitivity analysis</a></li>
      <li><a href="#non-estimable-case-equi-correlation">Non-estimable case: equi-correlation</a></li>
      <li><a href="#non-estimable-case-blocks">Non-estimable case: blocks</a></li>
      <li><a href="#an-estimable-block-pattern">An estimable block pattern</a></li>
      <li><a href="#selecting-the-best-parametric-model">Selecting the best parametric model</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter Solymos, Subhash R. Lele, Theodore M. Cole, Liangyuan Hu, Joan T. Richtsmeier.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
